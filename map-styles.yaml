quiet-la-colors:
    text:
        - &text             '#757575'
    areas:
        - &background       '#efebe7'
        - &land             '#f4f2ed'
        - &forest           '#dee0d5'
        - &grass            '#e9ebe0'   # lighten(@forest, 5%)
        - &park             '#e1e3da'   # lighten(@forest, 3%)
        - &cemetery         '#e4e5dc'
        - &hospital         '#e8e4e8'
        - &school           '#e9e5eb'   # lighten(#D9D5E3, 5%)
        - &stadium          '#d9cdc1'
        - &beach            '#ebe2cd'
        - &runway           '#bfbebd'
        - &aerodrome        '#d6d6d6'
        - &building         '#e6e3df'
        - &building_outline 'rgba(0,0,0,0)'
        - &building_top     'rgba(230,230,230,1)'
        - &earth2_e    '#d8d3ca'           # urban early
        - &earth2_e2   '#d4cfc6'           # urban early fade in
        - &earth2_e3   '#dbd8d3'           # urban early fade in 3
        - &earth2_ev   true                # urban early visibility

        - &water            '#c3d5dd'
        - &residential      '#efede8'   # @land * 0.98
        - &commercial       '#edebe6'   # @land * 0.97
        - &industrial       '#eae6e4'   # @land * 0.96
        - &military         '#e8e4e1'   # @land * 0.95
        - &parking          '#eeeeee'
        - &pedestrian       '#e7e7e7'   # @parking * 0.97
        - &place_of_worship '#e3c5c9'
        - &admin            '#000000'
    borders:
        - &county_brdr      '#8a7c7c'
        - &california_brdr  '#827676'
        - &nation_brdr      '#a7a8ab'
        - &state_brdr       '#cbced1'
    roads:
        - &road             '#c8c8c1'
        - &road_text        '#757575'
        - &rail_line        '#c8c8c1'
        - &aeroway          '#dddddd'

sources:
    mapzen:
        type: TopoJSON
        url: https://vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson
    osm:
        type: TopoJSON
        url:  //vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson?api_key=vector-tiles---JwESU
    # counties:
    #     type: GeoJSON
    #     url: counties.geojson


cameras:
    perspective:
        type: flat

styles:
    dashed:
        base: lines
        dash: [1.25, 1.25]
        dash_background_color: red
    text-blend-order:
        base: text
        blend_order: 1
layers:
    earth:
        data: { source: osm, layer: earth }
        draw:
            polygons:
                order: 0
                color: *background
    ocean-water:
        data: { source: osm, layer: water }
        # don't filter ocean polys because OSM ocean split tiles don't have coherent areas
        filter: { kind: ocean }
        draw:
            polygons:
                order: function() { return feature.sort_key; }
                color: *water
                join: round
        water_boundaries-ocean:
            filter: { boundary: yes, $zoom: { min: 10 } }
            draw:
                lines:
                    order: function() { return feature.sort_key; }
                    color: *water
                    width: [[10,1px],[12,2px]]
                    join: round
    water-not-ocean:
        data: { source: osm, layer: water }
        filter: { not: { kind: [ocean,swimming_pool,playa] }, $zoom: { min: 1 } }
        draw:
            polygons:
                order: function() { return feature.sort_key; }
                color: *water
        inland-water:
            filter:
                all:
                    - kind: [lake, water, riverbank, reservoir, playa]
                any:
                    # limit show smaller landuse areas to higher zooms
                    - { $zoom: { min: 1 },  area: { min: 40000000000 } }
                    - { $zoom: { min: 2 },  area: { min: 20000000000 } }
                    # some weird natural earth scale set transition
                    - { $zoom: { min: 3 },  area: { min: 80000000000 } }
                    - { $zoom: { min: 4 },  area: { min: 5000000000 } }
                    - { $zoom: { min: 5 },  area: { min: 700000000 } }
                    - { $zoom: { min: 6 },  area: { min: 500000000 } }
                    - { $zoom: { min: 7 },  area: { min: 160000000 } }
                    - { $zoom: { min: 8 },  area: { min: 40000000 } }
                    - { $zoom: { min: 9 },  area: { min: 10000000 } }
                    - { $zoom: { min: 10 }, area: { min: 8000000 } }
                    - { $zoom: { min: 11 }, area: { min: 2000000 } }
                    - { $zoom: { min: 12 }, area: { min: 200000 } }
                    - { $zoom: { min: 13 }, area: { min: 100000 } }
                    - { $zoom: { min: 14 }, area: { min: 2000 } }
                    - { $zoom: { min: 15 } }
            draw:
                polygons:
                    color: *water
        other-water-areas:
            filter: { not: { kind: [lake, water, reservoir, playa] }, $zoom: { min: 11 }, area: { min: 100 } }
            draw:
                polygons:
                    color: *water
        playas:
            filter: { kind: playa, $zoom: {min: 6} }
            draw:
                polygons:
                    color: *water
        water_boundaries-not-ocean:
            filter: 
                all:
                    - boundary: yes
                    - $zoom: { min: 13 }
                any:
                    - { $zoom: { min: 13 }, area: { min: 2000 } }
                    - { $zoom: { min: 15 } }
            draw:
                lines:
                    order: function() { return feature.sort_key; }
                    color: *water
                    width: [[13,1.0px],[16,1.5px],[18,2m]]
                    join: round
        river:
            filter: { kind: [river,canal,stream,dam,ditch,drain], $zoom: { min: 13 } }
            draw:
                lines:
                    order: function() { return feature.sort_key; }
                    color: *water
                    width: [[13,0.5px],[14,1.0px],[16,1.5px],[18,4m]]
                    join: round

    swimming-pools:
        data: { source: osm, layer: water }
        filter: { kind:[swimming_pool], $zoom: { min: 17 } }
        draw:
            polygons:
                order: function() { return feature.sort_key; }
                color: "#d1e1e8"

    boundaries:
        data: { source: osm, layer: boundaries }
        draw:
            lines:
                order: function() { return feature.sort_key; }
        country:
            filter:
                any:
                    - type: country
                    - kind: nation
                    - admin_level: 2
            draw:
                lines:
                    color: *nation_brdr
                    width: [[1, 0.5px], [2, 1.0px], [4, 1.5px], [9, 2.5px], [14, 3.5px], [16, 4.5px], [17, 14m]]
            water:
                filter: { maritime_boundary: yes }
                draw:
                    lines:
                        visible: false
        region:
            filter:
                any:
                    - type: state
                    # territorial here is probably a hack
                    - kind: [state, department, region, provincial, territorial]
                    - admin_level: 4
            draw:
                lines:
                    color: *nation_brdr
                    width: [[1, 0.25px], [2, 0.5px], [4, 1.5px], [9, 1.5px], [14, 2px], [16, 2.5px], [17, 7m]]
            water:
                filter: { maritime_boundary: yes }
                draw:
                    lines:
                        visible: false
            early:
                filter: { scalerank: [0,3,4,5,6,7,8,9,10], $zoom: { max: 8 } }
                draw:
                    lines:
                        visible: false
        # county:
        #     filter:
        #         any:
        #             - admin_level: 6
        #     draw:
        #         lines:
        #             color: *county_brdr
        #             width: [[1, 0.5px], [2, 0.75px], [3, 1px], [5, 1.5px], [9, 3.5px], [14, 5.5px], [16, 6.5px], [17, 16m]]
        #             order: 400
        #     water:
        #         filter: { maritime_boundary: yes }
        #         draw:
        #             lines:
        #                 visible: false
    landuse:
        data: { source: osm, layer: landuse }
        draw:
            polygons:
                order: function() { return feature.sort_key; }
        aerodrome:
            filter: {kind: [aerodrome, apron]}
            draw:
                polygons:
                    color: *industrial
        arena:
            filter: {kind: arena}
            draw:
                polygons:
                    color: *stadium
        beach:
            filter: {kind: beach}
            draw:
                polygons:
                    color: *beach
        cemetery:
            filter: {kind: cemetery}
            draw:
                polygons:
                    color: *cemetery
        college:
            filter: {kind: college}
            draw:
                polygons:
                    color: *school
        commercial:
            filter: {kind: [commercial, retail] }
            draw:
                polygons:
                    color: *commercial
        farm:
            filter: {kind: [farm, farmland, farmyard] }
            draw:
                polygons:
                    color: *land
        footway:
            filter: {kind: footway}
            draw:
                polygons:
                    color: *land
        forest:
            filter: {kind: [forest, wood]}
            draw:
                polygons:
                    color: *forest
        grass:
            filter: {kind: [grass, meadow, scrub]}
            draw:
                polygons:
                    color: *grass
        hospital:
            filter: {kind: hospital}
            draw:
                polygons:
                    color: *hospital
        industrial:
            filter: {kind: [industrial, quarry, substation, wastewater_plant]}
            draw:
                polygons:
                    color: *industrial
        kindergarten:
            filter: {kind: kindergarten}
            draw:
                polygons:
                    color: *school
        military:
            filter: {kind: military}
            draw:
                polygons:
                    color: *military
        park:
            filter: {kind: [ common, dog_park, garden, golf_course, park, protected_area, national_park, nature_reserve,
                playground, pitch, recreation_ground, village_green, zoo] }
            draw:
                polygons:
                    color: *park
        parking:
            filter: {kind: parking }
            draw:
                polygons:
                    color: *parking
        pedestrian:
            filter: {kind: pedestrian}
            draw:
                polygons:
                    color: *pedestrian
        place_of_worship:
            filter: {kind: place_of_worship}
            draw:
                polygons:
                    color: *place_of_worship
        prison:
            filter: {kind: prison}
            draw:
                polygons:
                    color: *industrial
        railway:
            filter: {kind: railway}
            draw:
                polygons:
                    color: *industrial
        residential:
            filter: {kind: residential}
            draw:
                polygons:
                    color: *residential
        school:
            filter: {kind: school}
            draw:
                polygons:
                    color: *school
        sports_center:
            filter: {kind: [sports_center, sports_centre] }
            draw:
                polygons:
                    color: *stadium
        stadium:
            filter: {kind: stadium}
            draw:
                polygons:
                    color: *stadium
        university:
            filter: {kind: university}
            draw:
                polygons:
                    color: *school
        urban_area:
            filter: {kind: "urban area"}
            draw:
                polygons:
                    color: *residential
        wetland:
            filter: {kind: wetland}
            draw:
                polygons:
                    color: *land

    roads:
        data: { source: osm, layer: roads }
        filter:
            not: { kind: rail }
        draw:
            lines:
                interactive: true
                order: function() { return feature.sort_key; }
                cap: round
        highway:
            filter: { kind: highway }
            draw:
                lines:
                    order: 490
                    #cap: [[0,butt],[15,round]]
                    #join: round
                    color: *road
                    width: [[8, 1px], [14, 4.0px], [15, 6.0px], [16, 6.5px], [17, 20m]]
                    cap: round
                    outline:
                        color: *road
                        width: [[9, 0.5px], [12, 1px], [16, 2px], [18, 6px]]
            link:
                filter: { is_link: yes } # on- and off-ramps, etc
                draw:
                    lines:
                        color: *road
                        width: [[13, 0.15px], [14, 0.3px], [15, 2px], [16, 5m]]
                        cap: butt
                        outline:
                            color: *road
                            width: 0px
                early_link:
                    filter: { $zoom: { max: 15 } }
                    draw:
                        lines:
                            # except bridges and tunnels, their outlines should also self-sort
                            order: 352
                tunnel-link:
                    filter: {is_tunnel: yes, $zoom: {min: 13} }
                    draw:
                        lines:
                            color: *road
                            outline:
                                color: *road
            tunnel:
                filter: {is_tunnel: yes, $zoom: {min: 13} }
                draw:
                    lines:
                        color: *road
                        outline:
                            color: *road
            highway_bridge:
                filter: {is_bridge: yes}
                draw:
                    lines:
                        cap: round
                        outline:
                            cap: butt
        major_road:
            filter: { kind: major_road }
            draw:
                lines:
                    order: function() { return feature.sort_key; }
                    color: *road
                    width: [[8, 0.3px], [9, 0.4px], [12, 0.8px], [13, 1px], [14, 1.3px], [15, 2px], [16, 6m]]
        minor_road:
                filter: { kind: minor_road, not: { highway: service } }
                draw:
                    lines:
                        order: function() { return feature.sort_key; }
                        color: *road
                        width: [[12,0px], [13, 0.15px], [14, 0.3px], [15, 1px], [16, 2m]]

    # Airports
    aeroways:
        data: { source: osm, layer: roads }
        filter: { aeroway: [runway, taxiway] }
        aeroway_runway:
            filter: { aeroway: runway }
            draw:
                polygons:
                    order: function() { return feature.sort_key; }
                    color: *aeroway
                lines:
                    order: function() { return feature.sort_key; }
                    color: *aeroway
                    width: [[11, 3px], [20, 16px]]
        aeroway_taxiway:
            filter: { aeroway: taxiway }
            draw:
                lines:
                    order: function() { return feature.sort_key; }
                    color: *aeroway
                    width: [[11, 0.5px], [20, 6px]]

    buildings:
        data: { source: osm, layer: buildings }
        filter: { $zoom: { min: 15 }}
        draw:
            polygons:
                order: function() { return feature.sort_key; }
                color: *building
            lines:
                order: function() { return feature.sort_key; }
                color: "#c8c8c1"
                width: [[17,0],[18,1m],[20,0.5m]]
                style: lines

    water_label:
        data: { source: osm, layer: places }
        filter: { kind: [sea, ocean] }
        draw:
            text:
                text_source: name
                font:
                    family: 'Benton Gothic Regular'
                    size: 12px
                    fill: '#757575'
                    # stroke: { color: [255,255,255,0.7], width:1px }
                    stroke: { color: '#ffffff', width:1 }


    road_label_major:
        data: { source: osm, layer: roads }
        filter: {name: true, kind: major_road}
        draw:
            text:
                text_source: name
                offset: [0px, -14px]
                order: function() { return feature.sort_key; }
                font:
                    family: 'Benton Gothic Regular'
                    size: [[13, 20px], [14, 22px], [15, 24px], [16, 26px]]
                    fill: *road_text
                    stroke: {color: '#efebe7', width: 1}

    road_label_minor:
        data: { source: osm, layer: roads }
        filter: {name: true, kind: minor_road, $zoom: { min: 16 }}
        draw:
            text:
                text_source: name
                offset: [0px, -10px]
                order: function() { return feature.sort_key; }
                font:
                    family: 'Benton Gothic Regular'
                    size: 18px
                    fill: '#9C9C9C'
                    stroke: {color: '#efebe7', width: 1}


    places:
        data: { source: osm, layer: places }
        filter: { not: { kind: [ocean, sea] } }
        draw:
            text-blend-order:
                visible: false    # labels are enabled by each layer below
                font:
                    family: 'Benton Gothic Regular'
                    # weight: 500
                    fill: '#9C9C9C'

        country-z2:
            filter:
                all:
                    - kind: [country]
                    - $zoom: [2]
                    - name: ["United States of America","Brasil","中华人民共和国","Россия","Canada","Kalaallit Nunaat","Ísland","Australia","India","日本","Guam","Indonesia","South Africa","مصر","Nigeria","Kenya"]
            draw:
                text-blend-order:
                    priority: 3
                    visible: true
                    text_source: function() { return feature["name:en"] || feature["name"]; }
                    font:
                        fill: '#9C9C9C'
                        weight: 200
                        size: 20px
                        stroke: { color: *background, width: 4 }          
        country-z3:
            filter: { name: true, population: true, kind: [country], $zoom: [3] }
            draw:
                text-blend-order:
                    priority: 3
                    visible: true
                    text_source: function() { return feature["name:en"] || feature["name"]; }
                    font:
                        fill: '#9C9C9C'
                        weight: 200
                        size: 20px
                        stroke: { color: *background, width: 4 }
            early-ones:
                # US, Brazil, China, Russia, Canada, Greenland, Iceland, Australia, India, Japan, Guam, Indonesia, South Africa, Egypt, Nigeria, Kenya
                filter: { not: { name: ["United States of America","Brasil","中华人民共和国","España","Norge","Россия","Canada","Kalaallit Nunaat","Ísland","Australia","India","日本","Guam","Indonesia","South Africa","مصر","Nigeria","Kenya"] }, $zoom: {min: 3, max: 4} }
                draw:
                    text-blend-order:
                        visible: false
        country-z4:
            filter: { name: true, population: true, kind: [country], $zoom: [4] }
            draw:
                text-blend-order:
                    priority: 3
                    visible: true
                    text_source: function() { return feature["name:en"] || feature["name"]; }
                    font:
                        fill: '#9C9C9C'
                        weight: 200
                        size: 20px
                        stroke: { color: *background, width: 4 }
            early-ones-z4:
                filter: { name: [Nederland,Luxembourg,Liechtenstein,San Marino,Civitatis Vaticanæ,Crna Gora,Македонија,The Gambia,Burundi,Swaziland,الإمارات العربية المتحدة,العراق,Singapore,El Salvador,Belize,Trinidad and Tobago, Saint Lucia, Montserrat,Anguilla,República Dominicana,Bahamas,British Virgin Islands,Antigua and Barbuda,Grenada,Sint Maarten,Saint Kitts and Nevis,Cayman Islands,België - Belgique - Belgien], $zoom: {min: 4, max: 5} }
                draw:
                    text-blend-order:
                        visible: false
        country-z5:
            filter:
                all:
                    - name: true
                    - population: true
                    - kind: [country]
                    - $zoom: [5]
                any:
                    - { population: { min: 5000000 } }
                not:
                    - name: "United States of America"
            draw:
                text-blend-order:
                    priority: 3
                    visible: true
                    text_source: function() { return feature["name:en"] || feature["name"]; }
                    font:
                        fill: '#9C9C9C'
                        weight: 600
                        size: 20px
                        stroke: { color: *background, width: 4 }
            early-ones-z5:
                filter: { name: [Luxembourg,Liechtenstein,San Marino,Civitatis Vaticanæ,El Salvador,Belize,België - Belgique - Belgien], $zoom: {min: 5, max: 6} }
                draw:
                    text-blend-order:
                        visible: false
        country-z6:
            # South Ossetia and Abkhazia aren't countries (they are disputed areas)
            filter: { name: true, kind: [country], $zoom: [6], not: { name: "United States of America" } }
            draw:
                text-blend-order:
                    priority: 3
                    visible: true
                    text_source: function() { return feature["name:en"] || feature["name"]; }
                    font:
                        size: 20px
                        weight: 600
                        fill: '#9C9C9C'
                        stroke: { color: *background, width: 4 }
            small-ones-z6:
                filter: { name: [Luxembourg,Liechtenstein,San Marino,Civitatis Vaticanæ,België - Belgique - Belgien,Хуссар Ирыстон,Аҧсны - Абхазия], $zoom: {min: 6, max: 7} }
                draw:
                    text-blend-order:
                        visible: false
        country-z7:
            # South Ossetia and Abkhazia aren't countries (they are disputed areas)
            filter: { name: true, kind: [country], $zoom: { min: 7, max: 9 }, not: { name: "United States of America" } }
            draw:
                text-blend-order:
                    priority: 3
                    visible: true
                    text_source: function() { return feature["name:en"] || feature["name"]; }
                    font:
                        size: 20px
                        weight: 600
                        fill: '#9C9C9C'
                        stroke: { color: *background, width: 4 }
            small-ones-z7:
                filter: { name: [Liechtenstein,San Marino,Civitatis Vaticanæ,Хуссар Ирыстон,Аҧсны - Абхазия], $zoom: {min: 7, max: 8} }
                draw:
                    text-blend-order:
                        visible: false
        regionz5-6:
            filter: { name: ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"], kind: [state], $zoom: {min: 5, max: 7} }
            draw:
                text-blend-order:
                    priority: 14
                    visible: true
                    text_source: function() { return feature["name:abbreviation"] || feature["name"]; }
                    font:
                        size: 30px
                        weight: 200
                        fill: [0.5,0.5,0.5,0.5]
                        stroke: { color: *background, width: 4 }
        regionz7-9:
            filter: { name: true, kind: [state], $zoom: {min: 7, max: 9} }
            draw:
                text-blend-order:
                    priority: 14
                    visible: true
                    text_source: function() { if(feature["name:short"]) { return feature["name"]; } else { return ""; } }
                    font:
                        size: 30px
                        weight: 200
                        fill: [0.5,0.5,0.5,0.5]
                        stroke: { color: *background, width: 4 }
                        transform: uppercase
            small-ones:
                filter: { name: ["Delaware","New Jersey","Connecticut","Rhode Island","Massachusetts","New Hampshire","Vermont"], $zoom: {min: 7, max: 8} }
                draw:
                    text-blend-order:
                        text_source: function() { return feature["name:abbreviation"] || feature["name"]; }
                        font: { transform: uppercase }



<!DOCTYPE html>
<html>
<head>
	<title>Web map maker</title>
	<meta charset="utf-8" />
	<link rel="shortcut icon" type="image/x-icon" href="http://d1qqc1e9kvmdh8.cloudfront.net/img/favicon.ico">

    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/bootstrap/2.3.2/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/css/ngux-tophat-0.4.5.min.css" />
    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/bootstrap/2.3.2/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/css/ngux-tophat-responsive-0.4.5.min.css" />

	<link rel="stylesheet" href="http://d1qqc1e9kvmdh8.cloudfront.net/js/leaflet-1.0.0-b1/leaflet.css">
    <!-- <link rel="stylesheet" href="http://latimes-graphics-media.s3.amazonaws.com/styles/leaflet-extra.css" /> -->
	<link rel="stylesheet" href="styles/jquery.geocodify.css"/>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://d1qqc1e9kvmdh8.cloudfront.net/bootstrap/2.3.2/js/bootstrap.min.js"></script>

	<script src="http://d1qqc1e9kvmdh8.cloudfront.net/js/underscore-1.8.3-min.js"></script>
    <script src="http://d1qqc1e9kvmdh8.cloudfront.net/js/leaflet-1.0.0-b1/leaflet-src.js"></script>
	<script src="js/mapbox-gl-0.15.0.js"></script>

    <script src="http://latimes-graphics-media.s3.amazonaws.com/js/geocode-wpt.js"></script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="js/jquery.geocodify.js"></script>


	<style type="text/css" media="screen">
	#map {width:1300px; height:731px}
	input.geocodify { width:275px; }
	label {font:18px/27px Georgia, serif;}

	.footnote {font-family:arial; font-size:12px; color:#666;}
	.leaflet-control-zoom{display:none;}
	.header{text-transform: uppercase; font-weight:bold; font-family:Arial; font-size:12px;}
	.leaflet-popup-content-wrapper{background-color:#000;}
	.leaflet-popup-content{font:bold 34px/36px Arial; color: white;}
	.leaflet-popup .leaflet-zoom-animated{bottom:0px !important;}
	.leaflet-control-attribution {font-size: 22px !important;height:26px; color:#777; padding:4px 0 0 9px;}
 	.leaflet-control-attribution a{display:none;}
	.leaflet-control-scale-line{font-size: 16px !important;height:26px;border: 2px solid #999; border-color: rgba(0,0,0,.4);border-top: 0;}
	.leaflet-marker-icon {display:none;}
	.leaflet-popup-tip-container {
		width: 20px;
		height: 27px;
		margin: 0 auto;
		position: relative;
		background-image: url('shaddow.png');
		background-position: center bottom;
	}
	.leaflet-popup-tip {
		border-top: 20px solid #000;
		box-shadow: none;
	}
	</style>

</head>
<body>
    <nav title="Navigation">
        <div id="tophat-container">
    		<div id="tophat">

	            <span id="tophat-dropdown">
	                <hr />
	                <hr />
	                <hr />
	            </span>

                <a id="tophat-logo" href="http://www.latimes.com/"></a>

                <div class="tophat-links">
                    <ul>
					    <li>
					        <a href="http://www.latimes.com/local">Local</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/california">California</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/sports">Sports</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/entertainment">Entertainment</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/nation">Nation</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/world">World</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/business">Business</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/opinion">Opinion</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/style">Lifestyle</a>
					    </li>
					    <li>
					        <a href="http://www.latimes.com/travel">Travel</a>
					    </li>
					</ul>
                </div>
		    </div>
		</div>
    </nav>


	<!-- CONTENT GOES HERE -->
    <div class="container" id="container">
		<h1>Web map maker <span style="font-size:16px; font-weight:normal;">(use Safari or Chrome browsers)</span></h1>
		<p>This tool is for aproximate location only. Geocoders can mislocate addresses by small distances.</p>

		<label for="mapPicker">1. Choose a base map</label>
		<select id="mapPicker">
		  <option value="latimesmapping.db744287">Quiet World</option>
		  <option value="latimesmapping.e47fff09">Relief World</option>x
		</select>
		<span class="footnote"> &nbsp;State boundaries are available in U.S. only.</span>
		<br/><br/>

		<label for="popupText">2. Write popup text </label>
		<input class="geocodify" type="text" id="popupText" maxlength="40" placeholder="40 chars max">
		<br/><br/>

		<label for="address">3. Search</label>
		<input type="text" id="address"  placeholder="Enter a complete address">
		<input type="button" onclick="findAddress()" id="addressBtn" class="btn" value="GO"> <span class="footnote"> &nbsp;City names now produce popups</span><br /> <br />

		<label for="lat"  >... Or enter Latitude:</label>
		<input class="geocodify" type="text" id="lat" placeholder="34.052010">
		<label for="lon"  >&nbsp; Longitude:</label>
		<input class="geocodify" type="text" id="lon" placeholder="-118.245796">
		<input type="button" onclick="findLatLon()" id="latLonBtn" class="btn" value="GO">

		<br/><br/>

		<label >4. Adjust your zoom (scrollwheel).</label>
		<p class="footnote">Do not zoom in super close unless you are 100% confident of a location. </p>
		<br/>

		<label >5. Move the map around so that the location is identifiable.</label>
		<div id="minimap"></div>

		<div id="web_blank">
			<p class="header">Click to <input type="button" class="btn" id="colwSave" value="Create an image"/></p>
			<div id="map"></div>
		</div>

		<div id="img-out"></div>

	</div>


	<footer title="Footer">
        <div id="footer-container">
		    <div id="footer">
	            <a id="footer-logo" href="http://www.latimes.com/"></a>

	            <div id="tos">
	                <a href="http://www.tribpub.com/central-terms-of-service/">Terms of Service</a> |
	                <a href="http://www.tribpub.com/privacy-policy-and-your-privacy-rights/">Privacy Policy</a> |
	                <a href="http://www.latimes.com/lat-about-our-ads,0,3875412.htmlstory">About Our Ads</a> |
	                <a href="http://www.latimes.com/services/site/la-reprint-request-splash,0,6731163.htmlstory">&copy; <script type="text/javascript">document.write(new Date().getFullYear())</script></a> |
	                <a href="http://www.latimes.com/about/">About This Site</a>
	            </div>
		    </div>
		</div>
	</footer>


	<script>
	mapboxgl.accessToken = "pk.eyJ1IjoiZW1hbWQiLCJhIjoiODY3ZGZkMjNhOTM3YTgwNWI4YTM3ZWFmNjIyODg4YjgifQ.UY6ZTL7-z1GCZYylBOm-VQ";

	var palette = {
		"admin": '#000000',
		"aerodrome": '#d6d6d6',
		"background": '#efebe7',
		"beach": '#ebe2cd',
		"building": '#e8e4e4',
		"commercial": '#edebe6',
		"forest": '#dee0d5',
		"grass": '#e9ebe0',
		"hospital": '#f1e2ee',
		"industrial": '#eae6e4',
		"land": '#f4f2ed',
		"military": '#e8e4e1',
		"park": '#e4e6db',
		"parking": '#eeeeee',
		"pedestrian": '#e7e7e7',
		"place_of_worship": '#e3c5c9',
		"residential": '#efede8',
		"runway": '#bfbebd',
		"school": '#e4e0ee',
		"stadium": '#d9cdc1',
		"water": '#c3d5dd',

		/* borders */
		'county_border': '#8a7c7c',
		'country_border': '#6E6666',
		'state_border': '#827676',

		/* roads */
		'road': '#c8c8c1',
		'road_text': '#757575',
		'rail_line': '#c8c8c1',
		'aeroway': '#dddddd',
		'widths': {
			"rdz11_maj": 1.5,
			"rdz12_maj": 2,
			"rdz13_maj": 3.3,
			"rdz14_maj": 3.4,
			"rdz15_maj": 5,
			"rdz16_maj": 8,

			"rdz11_med": 0.4,
			"rdz12_med": 0.5,
			"rdz13_med": 1,
			"rdz14_med": 1.3,
			"rdz15_med": 2,
			"rdz16_med": 3,

			"rdz13_min": 0.15,
			"rdz14_min": 0.3,
			"rdz15_min": 0.9,
			"rdz16_min": 1.2
		}
	};

	var quietLA = {
		"version": 8,
	    "name": "quiet LA",
		"sources": {
		  "osm": {
		    "type": "vector",
		    "tiles": ["https://vector.mapzen.com/osm/all/{z}/{x}/{y}.mvt?api_key=vector-tiles---JwESU"]
		  }
		},
		"layers": [{
		    "id": "background",
		    "type": "background",
		    "paint": {
		     	"background-color": palette.background
		    }
		},
		/* Landuse */
		{
		    "id": "water-polygon",
		    "source": "osm",
		    "source-layer": "water",
		    "type": "fill",
		    "filter": ["==", "$type", "Polygon"],
		    "paint": {
		       "fill-color": palette.water
		    }
		}, {
			"id": "aerodrome",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["in", "kind", "aerodrome", "apron"],
			"paint": {
			  "fill-color": palette.aerodrome
			}
		}, {
			"id": "beach",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["==", "kind", "beach"],
			"paint": {
			  "fill-color": palette.beach
			}
		}, {
			"id": "cemetery",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["==", "kind", "cemetery"],
			"paint": {
			  "fill-color": palette.park
			}
		}, {
			"id": "college",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["==", "kind", "college"],
			"paint": {
			  "fill-color": palette.school
			}
		}, {
			"id": "commercial",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["in", "kind", "commercial", "retail"],
			"paint": {
			  "fill-color": palette.commercial
			}
		}, {
			"id": "farm",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["in", "kind", "farm", "farmland", "farmyard"],
			"paint": {
			  "fill-color": palette.land
			}
		}, {
			"id": "footway",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["==", "kind", "footway"],
			"paint": {
			  "fill-color": palette.pedestrian
			}
		}, {
			"id": "forest",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["in", "kind", "forest", "wood"],
			"paint": {
			  "fill-color": palette.forest
			}
		}, {
			"id": "grass",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["in", "kind", "grass", "meadow", "scrub"],
			"paint": {
			  "fill-color": palette.grass
			}
		}, {
			"id": "hospital",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["==", "kind", "hospital"],
			"paint": {
			  "fill-color": palette.hospital
			}
		}, {
			"id": "industrial",
			"type": "fill",
			"source": "osm",
			"source-layer": "landuse",
			"filter": ["in", "kind", "industrial", "quarry", "railway", "substation", "wastewater_plant"],
			"paint": {
			  "fill-color": palette.industrial
			}
		}, {
		    "id": "military",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind",  "military"],
		    "paint": {
		      "fill-color": palette.military
		    }
		}, {
		    "id": "park",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["in", "kind",  "common", "dog_park", "garden", "golf_course", "park", "protected_area", "national_park", "nature_reserve", "playground", "pitch", "recreation_ground", "village_green", "zoo"],
		    "paint": {
		      "fill-color": palette.park
		    }
		}, {
		    "id": "parking",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind", "parking"],
		    "paint": {
		      "fill-color": palette.parking
		    }
		}, {
		    "id": "pedestrian",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind", "pedestrian"],
		    "paint": {
		      "fill-color": palette.pedestrian
		    }
		}, {
		    "id": "place_of_worship",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind", "place_of_worship"],
		    "paint": {
		      "fill-color": palette.place_of_worship
		    }
		}, {
		    "id": "prison",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind", "prison"],
		    "paint": {
		      "fill-color": palette.industrial
		    }
		}, {
		    "id": "residential",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["in", "kind", "residential", "urban area"],
		    "paint": {
		      "fill-color": palette.residential
		    }
		}, {
		    "id": "school",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["in", "kind",  "kindergarten", "school"],
		    "paint": {
		      "fill-color": palette.school
		    }
		}, {
		    "id": "sports_center",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["in", "kind",  "sports_center", "sports_centre", "stadium"],
		    "paint": {
		      "fill-color": palette.stadium
		    }
		}, {
		    "id": "university",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind", "university"],
		    "paint": {
		      "fill-color": palette.school
		    }
		}, {
		    "id": "wetland",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "landuse",
		    "filter": ["==", "kind", "wetland"],
		    "paint": {
		      "fill-color": palette.land
		    }
		},
		/* Buildings */
		{
		    "id": "buildings",
		    "type": "fill",
		    "source": "osm",
		    "source-layer": "buildings",
		    "paint": {
			    "fill-outline-color": "#cbc8c7",
			    "fill-color": palette.building
		    }
		},

		/* Roads  */
		{
		    "id": "highway",
		    "type": "line",
		    "source": "osm",
		    "source-layer": "roads",
		    "filter": ["==", "kind", "highway"],
		    "paint": {
		      	"line-color": palette.road,
		      	"line-width": {
		      		"stops": [[8, 0.7], [10, 0.8], [11, palette.widths.rdz11_maj]]
		      	}
		    }
		}, {
		    "id": "road",
		    "type": "line",
		    "source": "osm",
		    "source-layer": "roads",
		    "filter": ["any",["==", "kind", "minor_road"],["==", "kind", "major_road"]],
		    "paint": {
		      	"line-color": palette.road,
		      	"line-width": {
		      		"stops": [[8, 0.3], [10, 0.4], [11, palette.widths.rdz11_med]]
		      	}
		    }
		}, {
		    "id": "rail",
		    "type": "line",
		    "source": "osm",
		    "source-layer": "roads",
		    "filter": ["any", ["==", "type", "rail"], ["in", "kind", "railway", "rail"]],
		    "paint": {
		      	"line-color": palette.rail_line,
		      	"line-dasharray": {
		      		"stops": [[14, [1,1]], [15, [1,2]]]
		      	},
		      	"line-width": {
		      		"stops": [[13, 0], [14, 0.6], [15, 0.8], [16, 1.5]]
		      	}
		    }
		},

		/* Borders */
		{
	      	"id": "country-boundary",
	      	"source": "osm",
	      	"source-layer": "boundaries",
	      	"type": "line",
	      	"filter": ["==", "admin_level", "2"],
	      	"max-zoom": 4,
	      	"layout": {
	        	"line-cap": "round",
	        	"line-join": "round"
	      	},
	      	"paint": {
	        	"line-color": palette.country_border,
		      	"line-width": {
		        	"stops": [[7, 0.5], [8, 0.6], [9, 0.7], [10, 0.8], [11, 0.9], [12, 1.0], [13, 1.1], [14, 1.2], [15, 1.3], [16, 1.4]]
		        }
	      	}
	    }, {
	    	"id": "state-boundary",
	    	"source": "osm",
	    	"source-layer": "boundaries",
	    	"type": "line",
	    	"filter": ["==", "admin_level", "4"],
	      	"layout": {
	        	"line-cap": "round",
	        	"line-join": "round"
	      	},
	      	"paint": {
	        	"line-color": palette.state_border,
		      	"line-width": {
		        	"stops": [[7, 0], [8, 0.5], [9, 0.6], [10, 0.7], [11, 0.8], [12, 0.9], [13, 1.0], [14, 1.1], [15, 1.2]]
		        }
	      	}
	    },
		]
	};

	// jQuery map reference
	var $map = $('#map');

	var map = new mapboxgl.Map({
	  container: 'map',
	  style: quietLA,
	  zoom: 15,
	  minZoom: 2,
	  center: [-118.24, 34.0425]
	});

	// map.attributionControl.setPrefix('&copy; Los Angeles Times, &copy; Mapzen, &copy; OpenStreetMap, <a href="https://mapzen.com/tangram" target="_blank">Tangram</a>');

	map.addControl(new mapboxgl.Navigation());

	// L.control.scale().addTo(map);

	// var scene = layer.scene;

	// // Show selected feature on click
 //    scene.container.addEventListener('click', function (event) {
 //    	var pixel = {
 //    		x: event.clientX - $map.offset().left,
 //    		y: event.clientY - $map.offset().top + $(window).scrollTop()
 //    	};

	// 	scene.getFeatureAt(pixel).then(function(selection) {
	// 		if (!selection) {
	// 			return;
	// 		}

	// 		var feature = selection.feature;
	// 		if (feature != null) {
	// 			if (feature.properties != null) {
	// 				console.log(feature.properties);
	// 			}
	// 		}

	// 	});

 //    });


    $("#address").geocodify({
        onSelect: function (result) {
            console.log(result);
        },
        regionBias: 'US',
        viewportBias: new google.maps.LatLngBounds(
             new google.maps.LatLng(33.22030778968541,-118.948974609375),
             new google.maps.LatLng(35.0120020431607,-117.44384765625)
         ),
        filterResults: function(results) {
            return _.filter(results, function(addy) {
                return _.some(addy.address_components, function(component) {
                    return component.long_name === 'Los Angeles County';
                });
            });
        }
    });

	// var geocoder = L.mapbox.geocoder('mapbox.places-v1');
	// geocoder.query('los angeles, CA', setMap);
	function findAddress(){
		var getInput = document.getElementById('address').value;
		// geocoder.query(getInput, showMap);

		document.getElementsByClassName('leaflet-popup').style.bottom="0px"
	}

	function setMap(err, data) {
	    // The geocoder can return an area, like a city, or a
	    // point, like an address. Here we handle both cases,
	    // by fitting the map bounds to an area or zooming to a point.

	    if (data.lbounds) {
			map.fitBounds(data.lbounds);
	    } else if (data.latlng) {
			map.setView([data.latlng[0], data.latlng[1]], 13);
	    }
	}


	function showMap(err, data) {
	    // The geocoder can return an area, like a city, or a
	    // point, like an address. Here we handle both cases,
	    // by fitting the map bounds to an area or zooming to a point.

	    if (data.lbounds) {
			map.fitBounds(data.lbounds);
	    } else if (data.latlng) {
			map.setView([data.latlng[0], data.latlng[1]], 13);
	    }

		marker=L.marker([data.latlng[0], data.latlng[1]], {
		    icon: L.mapbox.marker.icon({
		        'marker-size': 'large',
		        'marker-color': '#fff'
		    })
		});
		marker.addTo(map);

		var getPopup = document.getElementById('popupText').value;

		marker.bindPopup(getPopup, {offset: new L.Point(0, 0)}).openPopup();
	}



	function findLatLon(){
		var getLat = document.getElementById('lat').value;
		var getLon = document.getElementById('lon').value;

		map.setView([getLat, getLon], 10);

		marker=L.marker([getLat, getLon],
			{
		    icon: L.mapbox.marker.icon({
		        'marker-size': 'small',
		        'marker-color': '#fff'
		    }
		)
		});

		marker.addTo(map);

		var getPopup = document.getElementById('popupText').value;
		marker.bindPopup(getPopup, {offset: new L.Point(0, 0)}).openPopup();
	}

	//
	// add enter key functionality   841 n alexandria ave los angeles

	var go = document.getElementById("addressBtn");
	var txt = document.getElementById("address");

	txt.addEventListener("keypress", function() {
	    if (event.keyCode == 13) go.click();
	});


	$(window).load(function(){
		$(function() {
		    $("#colwSave").click(function() {
		    	scene.screenshot().then(function(screenshot) { window.open(screenshot.url); });
		    });
		});
	});

	</script>


</body>
</html>

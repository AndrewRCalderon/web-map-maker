

<!DOCTYPE html>
<html>
<head>
    <title>Web map maker</title>
    <meta charset="utf-8" />
    <link rel="shortcut icon" type="image/x-icon" href="http://d1qqc1e9kvmdh8.cloudfront.net/img/favicon.ico">

    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/bootstrap/2.3.2/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/css/ngux-tophat-0.4.5.min.css" />
    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/bootstrap/2.3.2/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" type="text/css" href="http://d1qqc1e9kvmdh8.cloudfront.net/css/ngux-tophat-responsive-0.4.5.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.4.1/leaflet-geocoder-mapzen.css">

    <link rel="stylesheet" href="http://d1qqc1e9kvmdh8.cloudfront.net/js/leaflet-1.0.0-b1/leaflet.css">
    <!-- <link rel="stylesheet" href="http://latimes-graphics-media.s3.amazonaws.com/styles/leaflet-extra.css" /> -->
    <link rel="stylesheet" href="styles/jquery.geocodify.css"/>
    <link rel="stylesheet" href="styles/jquery-ui.css">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://d1qqc1e9kvmdh8.cloudfront.net/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <script src="http://d1qqc1e9kvmdh8.cloudfront.net/js/underscore-1.8.3-min.js"></script>
    <script src="http://d1qqc1e9kvmdh8.cloudfront.net/js/leaflet-1.0.0-b1/leaflet-src.js"></script>
    <script src="js/tangram.min.js"></script>
    <script src="js/fontfaceobserver.js"></script>
    <script src="js/canvas2svg.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="http://cookbook.latimes.com/js/leaflet-bing-layer-0.0.1.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.4.1/leaflet-geocoder-mapzen.js"></script>

    <style type="text/css" media="screen">
    @font-face {
        font-family: 'Benton Gothic Regular';
        src: url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-regular.eot');
        src: url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-regular.eot?#iefix') format('embedded-opentype'),
             url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-regular.woff') format('woff'),
             url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-regular.ttf') format('truetype');
        font-weight:normal;
        font-style:normal;
    }
    @font-face {
        font-family: 'Benton Gothic Bold';
        src: url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.eot');
        src: url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.eot?#iefix') format('embedded-opentype'),
             url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.woff') format('woff'),
             url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.ttf') format('truetype');
        font-weight:normal;
        font-style:normal;
    }

    #container {
        width: 98%;
        margin: 0 auto;
    }

    /* grid city */
    #grid_holder {
        padding: 0;
        overflow:hidden;
        margin: -30px 0 0 0;
        height: 1000px;
        width: 1500px;
        position: absolute;
    }

    .grid {
        border: 1px solid #ccc;
        border-width: 1px 0 0 1px;
        position: absolute;
    }

    .grid div {
        border: 1px solid #ccc;
        border-width: 0 1px 1px 0;
        float: left;
    }

    /* print column grid */
    .grid330 {
        border: 1px solid rgba(0,0,0,0);
        margin: -50px 0 0 25px;
    }

    .grid330 div {
        border-color: #4affff;
        border-bottom: 1px solid rgba(0,0,0,0);
        border-top: 1px solid rgba(0,0,0,0);
    }

    .grid100 {
        margin: -70px 0 0 -75px;
    }

    .grid100 div {
      border-color: #aaa;
    }

    .grid50 {
      opacity: 0.5;
      margin: -20px 0 0 -25px;
      border: none;
    }

    #map_area {
        min-height: 1000px;
        min-width: 1500px;
    }

    #map_ruler {
        font-family: 'Curior', monospace;
        font-size: 12px;
        margin: 0 0 0 25px;
        width: 2000px;
        height: 0;
    }

    #map_ruler div {
        height: 12px;
    }

    #map_ruler span {
        display: inline-block;
        margin: 0 0 0 4px;
        line-height: 100%
    }

    #col_ruler span {
        width: 326px;
    }

    #pixel_ruler span {
        width: 96px;
    }

    #map_holder {
        padding: 0;
        width: 1310px;
        height: 730px;
        margin: 25px 0 0 25px;
    }

    .ui-resizable-handle {
        z-index: 9999 !important;
    }

    #map {width:calc(100%-10px); height:100%; margin: 0 10px 10px 0;
        box-shadow: 0px 0px 5px rgba(0,0,0,0.4);
    }

    .ui-icon-gripsmall-diagonal-se {background-position: -81px -224px; right: 10px;}

    input.geocodify { width:275px; }
    label {font:18px/27px Georgia, serif;}

    .map-info, #map_options label {
        font-family: 'Benton Gothic Regular', Arial, sans-serif;
        display: inline-block;
        margin: 5px 10px 0 0;
    }

    #map_size {
        font-family: 'Benton Gothic Regular', Arial, sans-serif;
        float: right;
        padding: 0 10px 0 0;
    }

    #map_options {padding: 0 0 20px;}
    #map_options form { margin: 0 }
    #map_options input { margin: 0 0 6px; }

    .map_option {
        float: left;
        margin: 0 10px 0 0;
    }

    .footnote {font-family:arial; font-size:12px; color:#666;}
    /*.leaflet-control-zoom{display:none;}*/
    .header{text-transform: uppercase; font-weight:bold; font-family:Arial; font-size:12px;}
    .leaflet-popup-content-wrapper{background-color:#000;}
    .leaflet-popup-content{font:bold 34px/36px Arial; color: white;}
    .leaflet-popup .leaflet-zoom-animated{bottom:0px !important;}
    .leaflet-control-attribution {font-size: 22px !important;height:26px; color:#777; padding:4px 0 0 9px; display: none;}
    .leaflet-control-attribution a{display:none;}
    .leaflet-control-scale-line{font-size: 16px !important;height:26px;border: 2px solid #999; border-color: rgba(0,0,0,.4);border-top: 0;}
    .leaflet-marker-icon {display:none;}
    .leaflet-popup-tip-container {
        width: 20px;
        height: 27px;
        margin: 0 auto;
        position: relative;
        background-image: url('shaddow.png');
        background-position: center bottom;
    }
    .leaflet-popup-tip {
        border-top: 20px solid #000;
        box-shadow: none;
    }
    #tooltip {
        position: absolute;
        z-index: 2014;
        opacity:0;
        background: white;
        padding: 10px;
        border-style:solid;
        border-width:1px;
        border-color:#D4D4D4;
        box-shadow: 2px 2px 2px rgba(64,64,64,0.3);
        -moz-box-shadow: 2px 2px 2px rgba(64,64,64,0.3);
        -webkit-box-shadow: 2px 2px 2px rgba(64,64,64,0.3);
        border-radius: 2px;
        -moz-border-radius: 2px;
        height: 0;
        font-family: 'benton-gothic-regular', Arial, sans-serif;

    }
    </style>

</head>
<body>
    <nav title="Navigation">
        <div id="tophat-container">
            <div id="tophat">

                <span id="tophat-dropdown">
                    <hr />
                    <hr />
                    <hr />
                </span>

                <a id="tophat-logo" href="http://www.latimes.com/"></a>
            </div>
        </div>
    </nav>


    <!-- CONTENT GOES HERE -->
    <div class="container" id="container">
 <!--        <h1>Web map maker <span style="font-size:16px; font-weight:normal;">(use Safari or Chrome browsers)</span></h1>
        <p>This tool is for aproximate location only. Geocoders can mislocate addresses by small distances.</p>

        <label for="mapPicker">1. Choose a base map</label>
        <select id="mapPicker">
          <option value="latimesmapping.db744287">Quiet World</option>
          <option value="latimesmapping.e47fff09">Relief World</option>x
        </select>
        <span class="footnote"> &nbsp;State boundaries are available in U.S. only.</span>
        <br/><br/>

        <label for="popupText">2. Write popup text </label>
        <input class="geocodify" type="text" id="popupText" maxlength="40" placeholder="40 chars max">
        <br/><br/>

        <label for="address">3. Search</label>
        <input type="text" id="address"  placeholder="Enter a complete address">
        <input type="button" onclick="findAddress()" id="addressBtn" class="btn" value="GO"> <span class="footnote"> &nbsp;City names now produce popups</span><br /> <br />

        <label for="lat"  >... Or enter Latitude:</label>
        <input class="geocodify" type="text" id="lat" placeholder="34.052010">
        <label for="lon"  >&nbsp; Longitude:</label>
        <input class="geocodify" type="text" id="lon" placeholder="-118.245796">
        <input type="button" onclick="findLatLon()" id="latLonBtn" class="btn" value="GO">

        <br/><br/>

        <label >4. Adjust your zoom (scrollwheel).</label>
        <p class="footnote">Do not zoom in super close unless you are 100% confident of a location. </p>
        <br/>

        <label >5. Move the map around so that the location is identifiable.</label>
        <div id="minimap"></div>
 -->



        <div id="web_blank">


            <!-- <p class="header">Click to <input type="button" class="btn" id="colwSave" value="Create an image"/></p> -->
            <div id="map_options">
                <div class="map_option">
                    <form class="standalone-dropdown">
                        <fieldset>
                            <select onchange="sizeChange(this)" id="preset_sizes">
                                <option value="custom">Custom size</option>
                                <option value="video">Video</option>
                                <option value="web_large" selected>Web large</option>
                                <option value="web_small">Web small</option>
                                <option value="col1">1 column</option>
                                <option value="col2">2 column</option>
                                <option value="col3">3 column</option>
                                <option value="col4">4 column</option>
                            </select>
                        </fieldset>
                    </form>
                </div>
                <div class="map_option">
                    <form class="standalone-dropdown">
                        <fieldset>
                            <select onchange="layerChange(this)" id="layer_change">
                                <option value="quiet_la" selected>Quiet LA</option>
                                <option value="topo_la">Topo LA</option>
                                <option value="betty_la">Betty LA</option>
                                <option value="satellite">Satellite</option>
                            </select>
                        </fieldset>
                    </form>
                </div>

                <div class="map_option">
                    <label><input type="checkbox" name="transit" value="Tranist" onclick="optionChange()" checked> Transit lines</label>
                    <label><input type="checkbox" name="buildings" value="Buildings" onclick="optionChange()"> Buildings</label>
                    <label><input type="checkbox" name="zoom_lock" value="zoom_lock" onclick="optionChange()"> Lock zoom</label>
                    <label><input type="checkbox" name="pan_lock" value="pan_lock" onclick="optionChange()"> Lock pan</label>
                </div>

                <input type="file" id="files" name="files[]">

                <p class='map-info'>Zoom: <span id="zoom_level"></span></p>

            </div>
            <div id="map_area">
                <div id="grid_holder">
                    <div id="map_ruler">
                        <div id="col_ruler"></div>
                        <div id="pixel_ruler"></div>
                    </div>
                </div>
                <div id="map_holder">
                    <div id="map"></div>
                    <button class='btn' onclick='downloadSVG();'>Download SVG</button>
                    <button class='btn' onclick='downloadIMG();'>Download Image</button>
                    <div id="map_size"></div>
                </div>
            </div>


        </div>

        <div id="img-out"></div>
    </div>


    <footer title="Footer">
        <div id="footer-container">
            <div id="footer">
                <a id="footer-logo" href="http://www.latimes.com/"></a>

                <div id="tos">
                    <a href="http://www.tribpub.com/central-terms-of-service/">Terms of Service</a> |
                    <a href="http://www.tribpub.com/privacy-policy-and-your-privacy-rights/">Privacy Policy</a> |
                    <a href="http://www.latimes.com/lat-about-our-ads,0,3875412.htmlstory">About Our Ads</a> |
                    <a href="http://www.latimes.com/services/site/la-reprint-request-splash,0,6731163.htmlstory">&copy; <script type="text/javascript">document.write(new Date().getFullYear())</script></a> |
                    <a href="http://www.latimes.com/about/">About This Site</a>
                </div>
            </div>
        </div>
    </footer>


    <div id="tooltip">
        <p id="iCount"></p>
        <p id="tCount"></p>
        <p id="vCount"></p>
    </div>

    <script>
    // Get window width
    var windowWidth = document.documentElement.clientWidth;
    var windowHeight = document.documentElement.clientHeight;

    // user map options
    // this stores all the user's map edits so they can be reloaded
    var userOptions = {}

    // build the map's ruler
    function createGrid(size) {
        var ratioW = 1600/size,
            ratioH = 1600/size;
                
        var parent = $('<div />', {
            class: 'grid', 
            width: ratioW  * size, 
            height: ratioH  * size
        }).addClass('grid' + ' grid'+size).appendTo('#grid_holder');

        for (var i = 0; i < ratioH; i++) {
            for(var p = 0; p < ratioW; p++){
                $('<div />', {
                    width: size - 1, 
                    height: size - 1
                }).appendTo(parent);
            }
        }
    }

    for (var i = 0; i < 1500; i+=10) {
        // checks if fits for print or web columns
        if (i % 330 === 0) {
            var text = "<span class='px_measure'>"+i/330+" col</span>";
            $("#col_ruler").append(text);
        } else if (i % 100 === 0 && i <= 1400) {
            var text = "<span class='px_measure'>"+i+"px</span>";
            $("#pixel_ruler").append(text);
        }
    }

    createGrid(50);
    createGrid(100);
    createGrid(330);

    /* add commas to numbers*/
    function commafy(num) {
        var s = String(num).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return s;
    }
    var palette = {
        "admin": '#000000',
        "aerodrome": '#d6d6d6',
        "background": '#efebe7',
        "beach": '#ebe2cd',
        "building": 'rgba(222,222,222,0.76)',
        "building_outline": "rgba(0,0,0,0)",
        "building_top": "rgba(230,230,230,1)",
        "cemetery": "#e4e5dc",
        "commercial": '#edebe6',
        "forest": '#dee0d5',
        "grass": '#e9ebe0',
        "hospital": '#e8e4e8',
        "industrial": '#eae6e4',
        "land": '#f4f2ed',
        "military": '#e8e4e1',
        "park": '#e1e3da',
        "parking": '#eeeeee',
        "pedestrian": '#e7e7e7',
        "place_of_worship": '#e3c5c9',
        "residential": '#efede8',
        "runway": '#bfbebd',
        "school": '#e4e0ee',
        "stadium": '#d9cdc1',
        "water": '#c3d5dd',

        /* borders */
        'county_border': '#8a7c7c',
        'country_border': '#6E6666',
        'state_border': '#827676',

        /* roads */
        'road': '#c8c8c1',
        'road_text': '#757575',
        'rail_line': '#c8c8c1',
        'aeroway': '#dddddd',
        'widths': {
            "rdz11_maj": 1.5,
            "rdz12_maj": 2,
            "rdz13_maj": 3.3,
            "rdz14_maj": 3.4,
            "rdz15_maj": 5,
            "rdz16_maj": 8,

            "rdz11_med": 0.4,
            "rdz12_med": 0.5,
            "rdz13_med": 1,
            "rdz14_med": 1.3,
            "rdz15_med": 2,
            "rdz16_med": 3,

            "rdz13_min": 0.15,
            "rdz14_min": 0.3,
            "rdz15_min": 0.9,
            "rdz16_min": 1.2
        }
    };

    var quietLA = {
        "version": 8,
        "name": "quiet LA",
        "sources": {
          "osm": {
            "type": "vector",
            "tiles": ["https://vector.mapzen.com/osm/all/{z}/{x}/{y}.mvt?api_key=vector-tiles---JwESU"]
          }
        },
        "sprite": "mapbox://sprites/latimesmapping/cih6hi2uq00bua0m3scl3fszx",
        "glyphs": "/fonts/{fontstack}/{range}.pbf",
        "layers": [{
            "id": "background",
            "type": "background",
            "paint": {
                "background-color": palette.background
            }
        },

        /* Landuse */
        /* For some reason, a few of these look like they need to be painted first */
        /* Especially park which causes islands not to show up. */
        {
            "id": "park",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind",  "common", "dog_park", "garden", "golf_course", "park", "protected_area", "national_park", "nature_reserve", "playground", "pitch", "recreation_ground", "village_green", "zoo"],
            "paint": {
              "fill-color": palette.park
            }
        }, {
            "id": "cemetery",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "cemetery"],
            "paint": {
              "fill-color": palette.cemetery
            }
        }, {
            "id": "hospital",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "hospital"],
            "paint": {
              "fill-color": palette.hospital
            }
        },
        {
            "id": "waterway",
            "interactive": true,
            "source": "osm",
            "source-layer": "water",
            "type": "line",
            "layout": {
                "line-cap": "round"
            },
            "filter": ["all", ["!=", "class", "river"], ["!=", "class", "stream"], ["!=", "class", "canal"]],
            "paint": {
               "line-color": palette.water,
               "line-width": {
                   "base": 1.3,
                   "stops": [[13, 0.5], [20, 2]]
               }
            }
        }, {
            "id": "waterway_river",
            "source": "osm",
            "source-layer": "water",
            "type": "line",
            "layout": {
                "line-cap": "round"
            },
            "filter": ["==", "class", "river"],
            "paint": {
               "line-color": palette.water,
               "line-width": {
                   "base": 1.3,
                   "stops": [[11, 0.5], [20, 6]]
               }
            }
        }, {
            "id": "waterway_stream_canal",
            "source": "osm",
            "source-layer": "water",
            "type": "line",
            "layout": {
                "line-cap": "round"
            },
            "filter": ["in", "class", "stream", "canal"],
            "paint": {
               "line-color": palette.water,
               "line-width": {
                   "base": 1.3,
                   "stops": [[13, 0.5], [20, 4]]
               }
            }
        }, {
            "id": "water",
            "interactive": true,
            "source": "osm",
            "source-layer": "water",
            "type": "fill",
            "filter": ["==", "$type", "Polygon"],
            "paint": {
               "fill-color": palette.water
            }
        }, {
            "id": "playa",
            "interactive": true,
            "source": "osm",
            "source-layer": "water",
            "type": "fill",
            "filter": ["all", ["==", "$type", "Polygon"], ["in", "kind", "playa", "Playa", "Alkaline Lake"]],
            "paint": {
               "fill-color": palette.background
            }
        }, {
            "id": "beach",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "beach"],
            "paint": {
              "fill-color": palette.beach
            }
        }, {
            "id": "college",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "college"],
            "paint": {
              "fill-color": palette.school
            }
        }, {
            "id": "commercial",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind", "commercial", "retail"],
            "paint": {
              "fill-color": palette.commercial
            }
        }, {
            "id": "farm",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind", "farm", "farmland", "farmyard"],
            "paint": {
              "fill-color": palette.land
            }
        }, {
            "id": "footway",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "footway"],
            "paint": {
              "fill-color": palette.pedestrian
            }
        }, {
            "id": "forest",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind", "forest", "wood"],
            "paint": {
              "fill-color": palette.forest
            }
        }, {
            "id": "grass",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind", "grass", "meadow", "scrub"],
            "paint": {
              "fill-color": palette.grass
            }
        }, {
            "id": "industrial",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind", "industrial", "quarry", "railway", "substation", "wastewater_plant"],
            "paint": {
              "fill-color": palette.industrial
            }
        }, {
            "id": "military",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind",  "military"],
            "paint": {
              "fill-color": palette.military
            }
        }, {
            "id": "parking",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "parking"],
            "paint": {
              "fill-color": palette.parking
            }
        }, {
            "id": "pedestrian",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "pedestrian"],
            "paint": {
              "fill-color": palette.pedestrian
            }
        }, {
            "id": "place_of_worship",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "place_of_worship"],
            "paint": {
              "fill-color": palette.place_of_worship
            }
        }, {
            "id": "prison",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "prison"],
            "paint": {
              "fill-color": palette.industrial
            }
        }, {
            "id": "residential",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind", "residential", "urban area"],
            "paint": {
              "fill-color": palette.residential
            }
        }, {
            "id": "school",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind",  "kindergarten", "school"],
            "paint": {
              "fill-color": palette.school
            }
        }, {
            "id": "sports_center",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["in", "kind",  "sports_center", "sports_centre", "stadium"],
            "paint": {
              "fill-color": palette.stadium
            }
        }, {
            "id": "university",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "university"],
            "paint": {
              "fill-color": palette.school
            }
        }, {
            "id": "wetland",
            "type": "fill",
            "source": "osm",
            "source-layer": "landuse",
            "filter": ["==", "kind", "wetland"],
            "paint": {
              "fill-color": palette.land
            }
        },

        /* Buildings */
        {
            "id": "buildings",
            "interactive": true,
            "type": "fill",
            "source": "osm",
            "source-layer": "buildings",
            "paint": {
                "fill-outline-color": palette.building_outline,
                "fill-color": palette.building
            }
        },
        {
            "id": "building_top",
            "ref": "buildings",
            "paint": {
                "fill-color": palette.building_top,
                "fill-opacity": {
                    "base": 1,
                    "stops": [[15,0],[16, 1]]
                },
                "fill-translate": {
                    "stops": [
                        [15,[0,0]],[16,[-2,-2]]],
                    "base": 1
                },
                "fill-outline-color": "rgba(222,217,213,0)",
                "fill-translate-anchor": "viewport"
            }
        },
        /* Roads  */
        {
            "id": "highway",
            "interactive": true,
            "minzoom": 5,
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["==", "highway", "motorway"],
            "paint": {
                "line-color": palette.road,
                "line-width": {
                    "base": 1.2,
                    "stops": [[3, 0], [6,1], [10, 1.3], [11, 1.7], [12, 2], [13, 3.3], [14, 6], [15, 8], [16, 12]]
                }
            }
        }, {
            "id": "road_motorway_link",
            "interactive": true,
            "minzoom": 5,
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["==", "highway", "motorway_link"],
            "paint": {
                "line-color": palette.road,
                "line-width": {
                    "base": 1.2,
                    "stops": [[8, 0.3], [9, 0.4], [12, 1], [14, 2], [15, 3]]
                }
            }
        },
        {
            "id": "road_major",
            "interactive": true,
            "minzoom": 12,
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["==", "kind", "major_road"],
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "paint": {
                "line-color": palette.road,
                "line-width": {
                    "stops": [[8, 0.3], [9, 0.4], [12,0.5], [13, 1], [14, 1.3], [15, 5], [16, 8]]
                }
            }
        }, {
            "id": "road_minor",
            "interactive": true,
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["==", "kind", "minor_road"],
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "paint": {
                "line-color": palette.road,
                "line-width": {
                    "stops": [[13, 0.15], [14, 0.3], [15, 0.9], [16, 1.2], [18, 2]]
                }
            }
        }, {
            "id": "road_service",
            "interactive": true,
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["==", "highway", "service"],
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "paint": {
                "line-color": palette.road,
                "line-width": {
                    "stops": [[13, 0.1], [14, 0.2], [15, 0.6], [16, 0.8]]
                }
            }
        }, {
            "id": "road_path",
            "interactive": true,
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["==", "kind", "path"],
            "paint": {
                "line-color": palette.road,
                "line-dasharray": [1, 1],
                "line-width": {
                    "base": 1.2,
                    "stops": [[12, 0], [13, 0.1], [14, 0.6], [15, 1], [16, 2]]
                }
            }
        },


        // Maybe a substyle for service = yard
        {
            "id": "rail",
            "interactive": true,
            "type": "line",
            "source": "osm",
            "source-layer": "roads",
            "filter": ["in", "kind", "railway", "rail"],
            "paint": {
                "line-color": palette.rail_line,
                "line-dasharray": {
                    "stops": [[14, [1,1]], [15, [1,2]]]
                },
                "line-width": {
                    "stops": [[14, 0.4], [15, 0.75], [20, 2]]
                }
            }
        },

        {
            "interactive": true,
            "minzoom": 11,
            "filter": ["all", ["==", "$type", "Polygon"],["==","aeroway","runway"]],
            "type": "fill",
            "source": "osm",
            "id": "aeroway_fill",
            "paint": {
                "fill-color": "#f00",
                "fill-opacity": 0.7
            },
            "source-layer": "roads"
        }, {
            "interactive": true,
            "minzoom": 11,
            "filter": ["==","aeroway","runway"],
            "type": "line",
            "source": "osm",
            "id": "aeroway_runway",
            "layout": {
                "line-cap": "square"
            },
            "paint": {
                "line-color": "#ddd",
                "line-width": {
                    "base": 1.2,
                    "stops": [[11, 3], [20, 16]]
                }
            },
            "source-layer": "roads"
        }, {
            "interactive": true,
            "minzoom": 11,
            "filter": ["==","aeroway","taxiway"],
            "type": "line",
            "source": "osm",
            "id": "aeroway_taxiway",
            "paint": {
                "line-color": "#ddd",
                "line-width": {
                    "base": 1.2,
                    "stops": [[11, 0.5], [20, 6]]
                }
            },
            "source-layer": "roads"
        },

        /* Borders */
        {
            "id": "country_boundary",
            "interactive": true,
            "source": "osm",
            "source-layer": "boundaries",
            "type": "line",
            "filter": ["all", ["==", "admin_level", "2"], ["!=", "maritime_boundary", "yes"]],
            "max-zoom": 4,
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "paint": {
                "line-color": palette.country_border,
                "line-width": {
                    "stops": [[4, 1.4], [5, 2], [12, 8]]
                }
            }
        }, {
            "id": "state_boundary",
            "interactive": true,
            "source": "osm",
            "source-layer": "boundaries",
            "type": "line",
            "filter": ["all", ["==", "admin_level", "4"], ["!=", "maritime_boundary", "yes"]],
            "layout": {
                "line-cap": "round",
                "line-join": "round"
            },
            "paint": {
                "line-color": palette.state_border,
                "line-width": {
                    "base": 1,
                    "stops": [[4, 0.4], [5, 1], [12, 3]]
                }
            }
        },

        /* Labels */
        {
            "id": "water_label",
            "interactive": true,
            "source": "osm",
            "layout": {
                "text-font": [
                    "benton-gothic-regular-italic"
                ],
                "text-field": "{name}",
                "text-max-width": 5,
                "text-size": 12
            },
            "source-layer": "places",
            "type": "symbol",
            "filter": ["in", "kind", "sea", "ocean"],
            "paint": {
                "text-color": "#757575",
                "text-halo-width": 0,
                "text-halo-color": "rgba(255,255,255,0.7)"
            },
        },
        {
            "id": "city_label",
            "source": "osm",
            "source-layer": "places",
            "filter": ["all", ["==", "$type", "Point"], ["in", "kind", "city", "county", "district"]],
            "min-zoom": 10,
            "max-zoom": 14,
            "type": "symbol",
            "layout": {
                "text-field": "{name}",
                "text-font": [
                    "benton-gothic-regular"
                ],
                "text-max-width": 10,
                "text-letter-spacing": 0.1,
                "text-size": {
                    "stops": [[8, 14], [12, 21]]
                }
            },
            "paint": {
                "text-color": "#757575",
                "text-halo-color": "rgba(255,255,255,0.7)",
            }
         },
         // {
         //     "interactive": true,
         //     "source": "osm",
         //     "id": "poi_label_4",
         //     "source-layer": "places",
         //     "minzoom": 18,
         //     "layout": {
         //         // "icon-image": "{maki}-12",
         //         "text-font": [
         //             "benton-gothic-bold",
         //         ],
         //         "text-field": "{name}",
         //         "text-max-width": 9,
         //         "text-padding": 2,
         //         "text-offset": [
         //             0,
         //             0.6
         //         ],
         //         "text-anchor": "top",
         //         "text-size": 10
         //     },
         //     "filter": ["all", ["==", "$type", "Point"], ["==", "scalerank", 2]],
         //     "type": "symbol",
         //     "paint": {
         //         "text-color": "#f00",
         //         "text-halo-color": "#efebe7",
         //         "text-halo-width": 1,
         //         "text-halo-blur": 0.5,
         //         "icon-opacity": 0
         //     },
         // },
        {
            "interactive": true,
            "layout": {
                "text-font": [
                    "benton-gothic-regular",
                ],
                "text-field": "{name}",
                "symbol-placement": "line",
                "text-size": {
                    "stops": [[13, 10], [19, 12]]
                },
                "text-offset": [0, -0.7],
                "symbol-spacing": 300,
                "text-letter-spacing": 0.1,
                "symbol-avoid-edges": false
            },
            "filter": ["all", ["==", "$type", "LineString"], ["in", "class", "street", "street_limited", "path", "golf", "service", "driveway"]],
            "type": "symbol",
            "source": "osm",
            "id": "road_label_minor",
            "paint": {
                "text-color": "#757575",
                "text-halo-color": "#efebe7",
                "text-halo-width": 1,
                "text-halo-blur": 0.5
            },
            "source-layer": "roads"
        },
        {
            "source": "osm",
            "id": "road_label_main",
            "interactive": true,
            "source-layer": "roads",
            "layout": {
                "text-font": [
                    "benton-gothic-regular"
                ],
                "text-field": "{name}",
                "symbol-placement": "line",
                "text-size": {
                    "stops": [[13, 10], [19, 13]]
                },
                "text-offset": [0, -0.7],
                "symbol-spacing": 500,
                "text-letter-spacing": 0.1,
                "symbol-avoid-edges": false
            },
            "filter": ["all", ["==", "$type", "LineString"], ["==", "kind", "minor_road"]],
            "type": "symbol",
            "paint": {
                "text-color": "#757575",
                "text-halo-color": "#efebe7",
                "text-halo-width": 1,
                "text-halo-blur": 0.5
            },
        },
        {
            "source": "osm",
            "id": "road_label_major",
            "source-layer": "roads",
            "interactive": true,
            "layout": {
                "text-font": [
                    "benton-gothic-regular",
                ],
                "text-field": "{name}",
                "symbol-placement": "line",
                "text-size": {
                    "stops": [[13, 12], [19, 15]]
                },
                "text-offset": [0, -0.7],
                "symbol-spacing": 400,
                "text-letter-spacing": 0.1,
                "symbol-avoid-edges": false
            },
            "filter": ["all", ["==", "$type", "LineString"], ["==", "kind", "major_road"]],
            "type": "symbol",
            "paint": {
                "text-color": "#757575",
                "text-halo-color": "#efebe7",
                "text-halo-width": 1,
                "text-halo-blur": 0.5
            }
        },
        // {
        //     "interactive": true,
        //     "layout": {
        //         "text-size": 11,
        //         "icon-image": "state-other-{reflen}",
        //         "icon-rotation-alignment": "viewport",
        //         "symbol-spacing": 500,
        //         "text-font": [
        //             "benton-gothic-bold",
        //         ],
        //         "symbol-placement": "line",
        //         "text-rotation-alignment": "viewport",
        //         "icon-size": 1.1,
        //         "text-field": "{ref}"
        //     },
        //     "filter": ["all", ["==", "highway", "motorway"], ["in","reflen", 1, 2, 3, 4, 5, 6],
        //         ["!in", "shield", "us-state", "us-interstate", "us-interstate-duplex", "us-interstate-business", "us-highway-alternate", "us-highway-duplex", "us-highway-business", "us-interstate-truck", "us-highway"]],
        //     "type": "symbol",
        //     "source": "osm",
        //     "id": "road_label_other_shields",
        //     "paint": {
        //         "text-color": "#757575"
        //     },
        //     "source-layer": "roads"
        // },
        {
            "interactive": true,
            "layout": {
                "text-size": 11,
                "text-allow-overlap": false,
                "icon-image": "interstate-1",
                "icon-rotation-alignment": "viewport",
                "symbol-spacing": {
                    "base": 1,
                    "stops": [[0, 500], [10, 500], [22, 500]]
                },
                "text-font": [
                    "benton-gothic-bold"
                ],
                "icon-rotate": 0,
                "icon-allow-overlap": false,
                "symbol-placement": {
                    "base": 1,
                    "stops": [[0, "point"], [10, "point"], [11, "line"], [22, "line"]]
                },
                "text-rotation-alignment": "viewport",
                "icon-size": 1.1,
                "text-field": "{ref}",
                "icon-ignore-placement": false
            },
            "filter": ["all", ["==", "highway", "motorway"], ["in", "network", "US:I", "US:NHS High Priority Corridors"]],
            "type": "symbol",
            "source": "osm",
            "id": "road_label_interstate_shields",
            "paint": {
                "text-color": "#757575",
                "icon-opacity": 0.8,
                "text-opacity": 1
            },
            "source-layer": "roads"
        },

        ]
    };

    // jQuery map reference
    var $map = $('#map');
    var map = L.map('map', {
        attributionControl: true,
        center: new L.LatLng(34.0425, -118.24),
        zoom: 10,
        detectRetina: true
    });
    map.attributionControl.setPrefix('@latimesgraphics, &copy; Mapzen, &copy; OpenStreetMap, <a href="https://mapzen.com/tangram" target="_blank">Tangram</a>');
    var quietLAlayer = Tangram.leafletLayer({
        scene: 'map-styles.yaml',
        events: {
            click: function(selection) { console.log('Click!', selection); }
        }
    });
    quietLAlayer.addTo(map);
    L.control.scale().addTo(map);
    var scene = quietLAlayer.scene;


    // var circle = L.circle([34.053327, -118.247351], 500, {
    //     color: 'red',
    //     fillColor: '#f03',
    //     fillOpacity: 0.5
    // }).addTo(map);


    // make map resizable after load
    quietLAlayer.on("load",function(){
        $( function() {
            $( "#map_holder" ).resizable({grid:10});
        } );
    });

    // add map's size
    var mapSize = $("#map").width() + 'x' + $("#map").height();
    $("#map_size").text(mapSize);

    var geocoder = L.control.geocoder('search-JvsyzTW', {
        placeholder: 'Search for a location',
        panToPoint: false,
        markers: false,
        expanded: true,
        position: 'topright',
        attribution: ''
    }).addTo(map);


    // set init zoom
    var zoomRounded = Math.floor(map.getZoom()*10) / 10;
    $("#zoom_level").text(zoomRounded.toFixed(1));

    // and update it!
    map.on('zoomend', function() {
        zoomRounded = Math.floor(map.getZoom()*10) / 10;

        $("#zoom_level").text(zoomRounded.toFixed(1));
    });

// $("#map_holder").resizable({
// minWidth: 300,
// handles: "e",
// resize: function (event, ui) {
//     if(Math.abs(200 - ui.size.width) <= 15){
//         $("#map_holder").css("width", 1300);
//     }
// }
// });


    // function to fire after map's parent is resized
    $("#map_holder").resize(function(){
        // update map's size
        mapSize = $("#map").width() + 'x' + $("#map").height();
        $("#map_size").text(mapSize);

        // change size to custom
        if ($("#map").width() + 'x' + $("#map").height() == '1920x1080') {
            document.getElementById('preset_sizes').value = 'video';
        } else if ($("#map").width() + 'x' + $("#map").height() == '1300x730') {
            document.getElementById('preset_sizes').value = 'web_large';
        } else if ($("#map").width() + 'x' + $("#map").height() == '400x450') {
            document.getElementById('preset_sizes').value = 'web_small';
        } else if ($("#map").width() % 330 === 0) {
            document.getElementById('preset_sizes').value = 'col' + $("#map").width()/330;
        } else {
            document.getElementById('preset_sizes').value = 'custom';
        }


        setTimeout(
            function(){ 
                // add mo' map
                map.invalidateSize({ pan: false });
            }, 400
        );
    });




    // // Show selected feature on click
    // scene.container.addEventListener('click', function (event) {
    //     var pixel = {
    //         x: event.clientX - $map.offset().left,
    //         y: event.clientY - $map.offset().top + $(window).scrollTop()
    //     };
    //     scene.getFeatureAt(pixel).then(function(selection) {
    //         if (!selection) {
    //             return;
    //         }
    //         var feature = selection.feature;
    //         if (feature != null) {
    //             if (feature.properties != null) {
    //                 console.log(feature.properties);
    //             }
    //         }
    //     });
    // });


    // // Show selected feature on mouseover
// (function() {
    scene.container.onmousemove = handleMouseMove;

    function handleMouseMove(event) {
        var dot, eventDoc, doc, body, pageX, pageY;

        event = event || window.event; // IE-ism

        // If pageX/Y aren't available and clientX/Y are,
        // calculate pageX/Y - logic taken from jQuery.
        // (This is to support old IE)
        // if (event.pageX == null && event.clientX != null) {
        //     eventDoc = (event.target && event.target.ownerDocument) || document;
        //     doc = eventDoc.documentElement;
        //     body = eventDoc.body;

        //     event.pageX = event.clientX +
        //       (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
        //       (doc && doc.clientLeft || body && body.clientLeft || 0);
        //     event.pageY = event.clientY +
        //       (doc && doc.scrollTop  || body && body.scrollTop  || 0) -
        //       (doc && doc.clientTop  || body && body.clientTop  || 0 );
        // }




        var pixel = {
            x: event.clientX - $map.offset().left,
            y: event.clientY - $map.offset().top + $(window).scrollTop()
        };
        scene.getFeatureAt(pixel).then(function(selection) {
            // console.log(pixel);
            if (!selection) {
                return;
            }
            var feature = selection.feature;
            // console.log(selection);
            if (feature != null) {
                if (feature.properties != null) {
                    console.log(feature);

                    // $('#tooltip').css({'display':'block','opacity':1,'height':'auto'});
                    if (feature.properties.kind == 'highway'){
                        // console.log(feature.properties.ref);
                        $('#tooltip').text(feature.properties.ref);
                    } else {
                        // console.log(feature.properties.name);
                        $('#tooltip').text(feature.properties.name);
                    }
                } else {
                    $('#tooltip').text('');
                }
            }
        });

        // console.log(event.pageX)
        // Use event.pageX / event.pageY here
    }
// })();





    // scene.container.addEventListener('mouseover', function (event) {
    //     var pixel = {
    //         x: event.clientX - $map.offset().left,
    //         y: event.clientY - $map.offset().top + $(window).scrollTop()
    //     };
    //     scene.getFeatureAt(pixel).then(function(selection) {
    //         console.log(pixel);
    //         if (!selection) {
    //             return;
    //         }
    //         var feature = selection.feature;
    //         if (feature != null) {
    //             if (feature.properties != null) {
    //                 console.log(feature.properties.name);
    //             }
    //         }
    //     });
    // });

    // $("#address").geocodify({
    //     onSelect: function (result) {
    //         console.log(result);
    //     },
    //     regionBias: 'US',
    //     viewportBias: new google.maps.LatLngBounds(
    //          new google.maps.LatLng(33.22030778968541,-118.948974609375),
    //          new google.maps.LatLng(35.0120020431607,-117.44384765625)
    //      ),
    //     filterResults: function(results) {
    //         return _.filter(results, function(addy) {
    //             return _.some(addy.address_components, function(component) {
    //                 return component.long_name === 'Los Angeles County';
    //             });
    //         });
    //     }
    // });

    // // var geocoder = L.mapbox.geocoder('mapbox.places-v1');
    // // geocoder.query('los angeles, CA', setMap);
    // function findAddress(){
    //     var getInput = document.getElementById('address').value;
    //     // geocoder.query(getInput, showMap);

    //     document.getElementsByClassName('leaflet-popup').style.bottom="0px"
    // }

    // function setMap(err, data) {
    //     // The geocoder can return an area, like a city, or a
    //     // point, like an address. Here we handle both cases,
    //     // by fitting the map bounds to an area or zooming to a point.

    //     if (data.lbounds) {
    //         map.fitBounds(data.lbounds);
    //     } else if (data.latlng) {
    //         map.setView([data.latlng[0], data.latlng[1]], 13);
    //     }
    // }


    // function showMap(err, data) {
    //     // The geocoder can return an area, like a city, or a
    //     // point, like an address. Here we handle both cases,
    //     // by fitting the map bounds to an area or zooming to a point.

    //     if (data.lbounds) {
    //         map.fitBounds(data.lbounds);
    //     } else if (data.latlng) {
    //         map.setView([data.latlng[0], data.latlng[1]], 13);
    //     }

    //     marker=L.marker([data.latlng[0], data.latlng[1]], {
    //         icon: L.mapbox.marker.icon({
    //             'marker-size': 'large',
    //             'marker-color': '#fff'
    //         })
    //     });
    //     marker.addTo(map);

    //     var getPopup = document.getElementById('popupText').value;

    //     marker.bindPopup(getPopup, {offset: new L.Point(0, 0)}).openPopup();
    // }



    function findLatLon(){
        var getLat = document.getElementById('lat').value;
        var getLon = document.getElementById('lon').value;

        map.setView([getLat, getLon], 10);

        marker=L.marker([getLat, getLon],
            {
            icon: L.mapbox.marker.icon({
                'marker-size': 'small',
                'marker-color': '#fff'
            }
        )
        });

        marker.addTo(map);

        var getPopup = document.getElementById('popupText').value;
        marker.bindPopup(getPopup, {offset: new L.Point(0, 0)}).openPopup();
    }

    //
    // add enter key functionality   841 n alexandria ave los angeles

    // var go = document.getElementById("addressBtn");
    // var txt = document.getElementById("address");

    // txt.addEventListener("keypress", function() {
    //     if (event.keyCode == 13) go.click();
    // });


    $(window).load(function(){
        $(function() {
            $("#colwSave").click(function() {
                scene.screenshot().then(function(screenshot) { window.open(screenshot.url); });
            });
        });
    });

    // Move the tooltip with the mouse
    $(window).mousemove( function(e) {
        if (windowWidth > 400) {
            var tooltipHeight = $("#tooltip").height();
            mouseY = e.pageY;
            mouseX = e.pageX;
            $("#tooltip").css({"top":(mouseY+10)+"px","left":(mouseX+5)+"px"});

        }
    });

var losangeles = function() {
    $.getJSON('http://boundaries.latimes.com/1.0/boundary/los-angeles-county-2012/?format=geojson', function(data){
        var geojson_data = data.contents;
        scene.setDataSource('dynamic_data', { type: 'GeoJSON', data: geojson_data });
    });
}

// pulls the SVG from the canvas
function downloadSVG() {

    var canvas = findFirstDescendant("map", "canvas");

}

// fake it till you make it
// this forces a standard size for web
// window.devicePixelRatio = 1;

function downloadIMG() {
    window.devicePixelRatio = 1;

    scene.screenshot().then(function(screenshot) { 
        window.open(screenshot.url); 
    });
}

function optionChange() {
    // check options for current status and reload the map
    console.log('optionChange()');

    // zoom lock check
    var zoomChecked = document.getElementsByName("zoom_lock")[0].checked;
    if (zoomChecked) {
        $('.leaflet-control-zoom').css('display','none');
        map.touchZoom.disable();
        map.doubleClickZoom.disable();
        map.scrollWheelZoom.disable();
        map.boxZoom.disable();
        map.keyboard.disable();
    } else {
        $('.leaflet-control-zoom').css('display','block');
        map.touchZoom.enable();
        map.doubleClickZoom.enable();
        map.scrollWheelZoom.enable();
        map.boxZoom.enable();
        map.keyboard.enable();
    }

    // pan lock check
    var panChecked = document.getElementsByName("pan_lock")[0].checked;
    if (panChecked) {
        map.dragging.disable();
        map.options.scrollWheelZoom = 'center';
    } else {
        map.dragging.enable();
        map.options.scrollWheelZoom = '';
    }

}

function findFirstDescendant(parent, tagname) {
   parent = document.getElementById(parent);
   var descendants = parent.getElementsByTagName(tagname);
   if ( descendants.length )
      return descendants[0];
   return null;
}

// watching for anytime the size preset dropdown fires
var sizeChange = function(option) {
    if (option.value == 'video') {
        $("#map_holder").width(1930); // these have to be 10 over to compensate for resizable
        $("#map_holder").height(1080);        
    } else if (option.value == 'web_large') {
        $("#map_holder").width(1310);
        $("#map_holder").height(730);
    } else if (option.value == 'web_small') {
        $("#map_holder").width(410);
        $("#map_holder").height(450);
    } else if (option.value == 'col1') {
        $("#map_holder").width(340);
        $("#map_holder").height(700);
    } else if (option.value == 'col2') {
        $("#map_holder").width(670);
        $("#map_holder").height(700);
    } else if (option.value == 'col3') {
        $("#map_holder").width(1000);
        $("#map_holder").height(700);
    } else if (option.value == 'col4') {
        $("#map_holder").width(1330);
        $("#map_holder").height(700);
    }



    // end resizable
    // $("#map_holder").resizable("destroy");

    // update map's size
    mapSize = $("#map").width() + 'x' + $("#map").height();
    $("#map_size").text(mapSize);

    setTimeout(
        function(){ 
            // add mo' map
            map.invalidateSize({ pan: false });
            // $( "#map_holder" ).resizable({grid:10});
        }, 400
    );

};

function layerChange(option) {
    if (option.value == 'satellite') {
        var bingLayer = L.bingLayer("AqEQ_HqipMZe_KnMeHEJ_CEtkNG9Y34_aXaGeIya4fBtc4hTIA9KYzMfFaK5nbK5", {type: "Aerial"}).addTo(map);
        quietLAlayer.remove();
    }
}

// Apple's Magic Mouse is a little finicky--prevent scroll when mouse is down on map
$("#map").mousedown(function() {
    map.scrollWheelZoom.disable();
});
$("#map").mouseup(function() {
    map.scrollWheelZoom.enable();
});

        // function gatherinfo(id){

        //     leafletImage(id, doImage);

        //     function doImage(err, canvas) {
            
        //         if (document.getElementById('newInstructions')) {
        //             //do nothing
        //         } else {
        //             var newInstructions=document.createElement('p');
        //             newInstructions.id ='newInstructions';
        //             newInstructions.innerHTML =instructText;
        //             document.body.appendChild(newInstructions);
        //         }
                
        //         var img = document.createElement('img');
        //         var dimensions = id.getSize();
        //         img.width = dimensions.x;
        //         img.height = dimensions.y;
        //         img.src = canvas.toDataURL();
            
        //         if (document.getElementById('newImg')) {
        //             document.getElementById('newImg').innerHTML ='';
        //             document.getElementById('newImg').appendChild(img);
        //         } else {
        //             var newImg=document.createElement('div');
        //             newImg.id ='newImg';
        //             newImg.innerHTML ='';
        //             document.body.appendChild(newImg);
        //             document.getElementById('newImg').appendChild(img);
        //         }
        //         window.scrollTo(0,document.body.scrollHeight);
        //     }
        // }
        

    // function addJsonFeature(){
    //     var getData = document.getElementById('addJson').value;
        
    //     var jsonData = JSON.parse(getData);
                    
    //     var jsonLayer1 = new L.geoJson(jsonData,{
    //         style: function(feature) {return addStyle(feature);},
    //         pointToLayer: function (feature, latlng) {
    //             return L.circleMarker(latlng, pointStyle);
    //             }
    //     }).addTo(map_1col);
        
    //     var jsonLayer2 = new L.geoJson(jsonData,{
    //         style: function(feature) {return addStyle(feature);},
    //         pointToLayer: function (feature, latlng) {
    //             return L.circleMarker(latlng, pointStyle);
    //             }
    //     }).addTo(map_2col);
        
        
    //     var jsonLayer3 = new L.geoJson(jsonData,{
    //         style: function(feature) {return addStyle(feature);},
    //         pointToLayer: function (feature, latlng) {
    //             return L.circleMarker(latlng, pointStyle);
    //             }
    //     }).addTo(map_3col);
        
    //     var jsonLayer4 = new L.geoJson(jsonData,{
    //         style: function(feature) {return addStyle(feature);},
    //         pointToLayer: function (feature, latlng) {
    //             return L.circleMarker(latlng, pointStyle);
    //             }
    //     }).addTo(map_4col);
        
    //     var jsonLayerW = new L.geoJson(jsonData,{
    //         style: function(feature) {return addStyle(feature);},
    //         pointToLayer: function (feature, latlng) {
    //             return L.circleMarker(latlng, pointStyle);
    //             }
    //     }).addTo(map_web);
        
    //     var jsonLayerWS = new L.geoJson(jsonData,{
    //         style: function(feature) {return addStyle(feature);},
    //         pointToLayer: function (feature, latlng) {
    //             return L.circleMarker(latlng, pointStyle);
    //             }
    //     }).addTo(map_web_sm);
        
        
    //     function addStyle(feature){
    //     switch (feature.geometry.type) {
    //         case 'MultiPolygon': return polyStyle;
    //         case 'Polygon': return polyStyle;
    //         case 'MultiLineString': return lineStyle;
    //         case 'LineString': return lineStyle;
    //         case 'Point': return pointStyle;
    //     }}
        
    // }

  function handleFileSelect(evt) {
    // var files = evt.target.files; // FileList object

    // console.log(files[0]);

    // var reader = new FileReader();
      // Closure to capture the file information.
      // reader.onload = (function(theFile) {
      //   return function(e) {
      //     // Render thumbnail.
      //     var span = document.createElement('span');
      //     span.innerHTML = ['<img class="thumb" src="', e.target.result,
      //                       '" title="', escape(theFile.name), '"/>'].join('');
      //     document.getElementById('list').insertBefore(span, null);
      //   };
      // })(f);
    var f = evt.target.files[0]; 

     var r = new FileReader();
      r.onload = function(e) { 
          var contents = e.target.result;
        // alert( "Got the file.n" 
        //       +"name: " + f.name + "n"
        //       +"type: " + f.type + "n"
        //       +"size: " + f.size + " bytesn"
        //       + "starts with: " + contents.substr(1, contents.indexOf("n"))
        // );  
      console.log(contents);
      var parsedJSON = jQuery.parseJSON(contents)
      // add GeoJSON to map
        L.geoJson(parsedJSON, {
        // style: myStyle
        }).addTo(map);
      }
      r.readAsText(f);

      // Read in the image file as a data URL.
      // var test = reader.readAsText(files[0]);
      // console.log(test);


    // files is a FileList of File objects. List some properties.
    // var output = [];
    // for (var i = 0, f; f = files[i]; i++) {
    //   output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
    //               f.size, ' bytes, last modified: ',
    //               f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
    //               '</li>');
    // }
    // document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }

  // listen for file uploader
  document.getElementById('files').addEventListener('change', handleFileSelect, false);

</script>


</body>
</html>
